## 조립기(Assembler) 

[이전 내용](/스프링/chapter3/3_DI와의존객체변경의유연함.md)  

앞서 `DI`를 설명하면서 정의한 객체들을 `실제로 생성`하려고 할 때 어디에 생성하면 좋을까??  
간단하게 생각하면 `main 메소드`에서 객체를 생성하면 될 것 같다.
``` java
public class Main {
  public static void main(String[] args) { 
    MemberDao memberDao = new MemberDao(); 
    MemberRegisterService regSvc = new MemberRegisterService(memberDao); 
    ChangePasswordService pwdSvc = new ChangePasswordService(); 
    pwdSvc.setMemberDao(memberDao); 
    
    ... 
  
  }
}
```

위와 같이 `main 메서드`에서 의존 대상 객체를 생성하여 주입하는 것도 나쁘지는 않다.  
그러나, 좀 더 나은 방법은 `객체를 생성`하고 `의존 객체를 주입`해주는 클래스를 `별도로 작성`하는 것이다. 

`의존 객체를 주입`한다는 건 서로 다른 두 객체를 조립한다고 생각할 수 있는데, 이런 의미에서 해당 클래스를 `조립기`라 한다. 

ex) 회원 가입, 암호 변경 기능에 대한 조립기 
``` java
import spring.ChangePasswordService;
import spring.MemberDao;
import spring.MemberRegisterService;

public class Assembler {

	private MemberDao memberDao;
	private MemberRegisterService regSvc;
	private ChangePasswordService pwdSvc;
  
  // MemberRegisterService 객체와 ChangePasswordService 객체에 대한 의존을 주입한다.
  // MemberRegisterService는 생성자를 통해 주입받고
  // ChangePasswordService는 setter를 통해 주입받는다.
	public Assembler() {
		memberDao = new MemberDao();
		regSvc = new MemberRegisterService(memberDao);
		pwdSvc = new ChangePasswordService();
		pwdSvc.setMemberDao(memberDao);
	}

	public MemberDao getMemberDao() {
		return memberDao;
	}

	public MemberRegisterService getMemberRegisterService() {
		return regSvc;
	}

	public ChangePasswordService getChangePasswordService() {
		return pwdSvc;
	}

}
```

조립기가 생성한 객체의 연결관계를 그림으로 나타내면 아래와 같다. 

![image](https://user-images.githubusercontent.com/64796257/198022578-8c425bab-d228-4a16-afb8-7fdadb00fe11.png)

Assembler 클래스를 사용하고 싶다면 아래와 같이 사용해주면 된다.  
``` java
Assembler assembler = new Assembler(); 

ChangePasswordService changePwdSvc = assembler.getChangePasswordService(); 
changePwdSvc.changePassword(~~); 
```

1) `assembler.getChangePasswordService()`로 ChangePasswordService 객체를 구한다.
2) 이때 `ChangePasswordService 객체`는 `setter`를 통해서 MemberDao를 주입받는다. 

이렇듯 조립기는 `객체를 생성`하고 `의존 객체를 주입`하는 기능을 제공한다.  
또한 특정 객체가 필요한 곳에 `객체를 제공`한다. 

예를 들어, `Assembler 클래스`의 `getChangePasswordService()` 메서드는 `ChangePasswordService 객체`가 필요한 곳에서 사용된다. 

- 예시 코드 MainForAssembler.java  
그 중에서 `Assembler를 사용`한 코드 부분을 보겠다. 

``` java
  // Assembler 생성
  
  // 이렇게 Assembler 생성하는 시점에서 
  // MemberRegisterService 객체와 ChangePasswordService 객체를 생성하고 
  // 각 객체에 MemberDao 객체까지 의존 주입을 완료했다. 
  private static Assembler assembler = new Assembler();

	private static void processNewCommand(String[] arg) {
		if (arg.length != 5) {
			printHelp();
			return;
		}
    // assembler 에서 제공한 getMemberRegisterService()를 통해 
    // 필요한 객체를 구했다.
		MemberRegisterService regSvc = assembler.getMemberRegisterService();
		RegisterRequest req = new RegisterRequest();
		req.setEmail(arg[1]);
		req.setName(arg[2]);
		req.setPassword(arg[3]);
		req.setConfirmPassword(arg[4]);
		
		if (!req.isPasswordEqualToConfirmPassword()) {
			System.out.println("암호와 확인이 일치하지 않습니다.\n");
			return;
		}
		try {
			regSvc.regist(req);
			System.out.println("등록했습니다.\n");
		} catch (DuplicateMemberException e) {
			System.out.println("이미 존재하는 이메일입니다.\n");
		}
	}

	private static void processChangeCommand(String[] arg) {
		if (arg.length != 4) {
			printHelp();
			return;
		}
    
    // assembler 에서 제공한 getChangePasswordService()를 통해 
    // 필요한 객체를 구했다.
		ChangePasswordService changePwdSvc = assembler.getChangePasswordService();
		try {
			changePwdSvc.changePassword(arg[1], arg[2], arg[3]);
			System.out.println("암호를 변경했습니다.\n");
		} catch (MemberNotFoundException e) {
			System.out.println("존재하지 않는 이메일입니다.\n");
		} catch (WrongIdPasswordException e) {
			System.out.println("이메일과 암호가 일치하지 않습니다.\n");
		}
	}
```































