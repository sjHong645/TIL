## 이번 챕터에서 다룰 내용 

![image](https://user-images.githubusercontent.com/64796257/188577147-770a9eda-769b-456c-aa36-3eb76d91e651.png)

## 01 트랜잭션 

### 트랜잭션 개념 

데이터베이스는  
- 다수의 사용자가 `동시`에 사용하더라도 항상 `모순이 없는` 정확한 데이터를 유지해야 한다.
- `장애가 발생`하더라도 빨리 `원상태로 복구`할 수 있어야 한다.

DBMS는 `트랜잭션`을 이용해서 `DB의 회복과 병행 제어`를 가능하게 함으로써 DB의 `일관성`을 유지한다.

- 트랜잭션 : 하나의 작업을 수행하는 데 필요한 DB의 연산들을 모아놓은 것 ⇒ DB에서 `논리적인 작업의 단위`가 된다  
또한, DB에 `장애`가 발생했을 때 데이터를 `복구하는 작업의 단위`도 된다. 

### 트랜잭션의 특성 - ACID 

| 특성 | 내용 | 
| --- | --- | 
| 원자성(Atomicity) | 트랜잭션을 구성하는 연산들이 `모두 정상`적으로 실행되거나 `하나도 실행되지 않아`야 한다는 걸 의미 | 
| 일관성(Consistency) | 트랜잭선 성공 이후 ⇒ DB가 `일관된 상태`를 유지해야 함을 의미 | 
| 격리성(Isolation) | `현재 수행중인 트랜잭션`이 완료될 때까지 `다른 트랜잭션`들이 `접근할 수 없음`을 의미 | 
| 지속성(Duration) | 트랜잭션 성공 이후 ⇒ `DB에 반영한 수행 결과`는 어떤 경우에도 `손실되지 않고 영구적`이여야 함 | 

DBMS에서는 트랜잭션의 기능을 다음과 같이 제공한다.  
![image](https://user-images.githubusercontent.com/64796257/188581232-6d8f4573-d7ee-4f0a-a7a9-0bbd7ce33ac5.png)

### 트랜잭션 연산 

| 연산 | 내용 | 
| --- | --- | 
| commit | 트랜잭션이 `성공적`으로 수행되었음을 선언 (작업 완료) | 
| rollback | 트랜잭션을 수행하는데 `실패했음`을 선언 (작업 취소) | 

- commit 연산을 수행한 경우 

![image](https://user-images.githubusercontent.com/64796257/188581666-446c3b7d-1b7f-4d46-acf8-939e9a796f75.png)

- rollback 연산을 수행한 경우 

![image](https://user-images.githubusercontent.com/64796257/188581748-586663ee-9372-4084-a9e8-b610a187308f.png)

## 02 장애와 회복 

`트랜잭션의 특성을 보장`하고, DB를 모순이 없는 `일관된 상태로 유지`하기 위해서 DBMS는 `회복 기능`을 제공한다.

### 장애의 유형 

![image](https://user-images.githubusercontent.com/64796257/188583375-81a7fce5-5c9c-44fc-a97b-2d36b47a0c78.png)

### 회복 기법 

회복(recovery) : `장애`가 발생했을 때 DB를 `장애가 발생`하기 `이전 상태로 복구`시키는 것

#### 회복을 위한 연산 

`회복`의 주요 흐름은 다음과 같다. 

1) 데이터를 `별도의 장소`에 미리 복사해 둔다.
2) `장애`로 `문제가 발생`했을 때 
3) `복사본`이용해서 을 원상태로 복원하는 것

- 복사본을 만드는 방법 

| 이름 | 내용 | 
| --- | --- | 
| 덤프(dump) | `DB 전체`를 다른 저장 장치에 주기적으로 복사하는 방법 | 
| 로그(log) | `변경 연산`이 실행될 때 마다 `데이터 변경 이전/이후 값`을 `별도의 파일`에 기록하는 방법 | 

- 복구 방법 
① redo 연산 : 로그에 기록된 `변경 이후의 값`을 이용해 `변경 연산`을 `재실행`하는 방법으로 DB를 복구

② undo 연산 : 로그에 기록된 `변경 이전의 값`을 이용해 `변경 연산`을 `취소`하는 방법으로 DB를 복구 

#### 로그 회복 기법

- 즉시 갱신 회복 기법 : 트랜잭션 수행 중에 `데이터를 변경한 연산`의 `결과`를 DB에 `즉시 반영`한다.

그리고 `장애 발생에 대비`하기 위해 `데이터 변경에 대한 내용`을 `로그 파일`에다가 기록한다.

그래서 `DB 회복`때 로그를 정상적으로 쓸려면    
1) 트랜잭션에서 `데이터 변경 연산`이 `실행`될 때
2) 로그 파일에 `로그 레코드를 먼저 기록`하고
3) `DB 변경 연산`을 `반영`해야 한다

- 지연 갱신 회복 기법 : 변경 연산의 결과를 `로그 파일`에만 `기록`했다가 `부분완료`가 되면 로그에 있는 내용을 이용해 `DB에 한 번에 반영`한다.




#### 검사 시점 회복 기법

#### 미디어 회복 기법 

: `디스크에서 발생할 수 있는 장애`에 대비한 회복 기법

























