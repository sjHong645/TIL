## 34강 데이터베이스 설계

![image](https://user-images.githubusercontent.com/64796257/148313434-880f3f14-2dcb-4918-bb35-ffbc4acdc884.png)

설계도를 작성하는 건 굉장히 어렵다. 여기서는 DB 설계의 개념및 설계도를 읽는 방법 등에 관해서 알아보려 한다.

그리고 시스템 개발 현장에서 자주 사용되는 트랜잭션(transaction)에 대해서도 다뤄보자.

### 데이터베이스 설계

DB를 설계한다는 건 DB의 스키마 내에 테이블, 인덱스, 뷰 등의 DB 객체를 정의하는 것을 말한다. 스키마 내에서 정의한다는 뜻에서 `스키마 설계`라고 불리기도 한다. 

DB 설계의 주된 내용은 테이블의 이름이나 열, 자료형을 결정하는 것이다.

'이 테이블은 이 열을 이용해서 저쪽 테이블과 연결한다'와 같이 테이블 간의 관계를 생각하면서 여러 테이블을 정의하고 작성한다.

- 논리명과 물리명 

테이블을 설계할 때 테이블 정의서나 설계도 등의 문서를 작성하는 경우가 많다. 일반적으로 다음과 같은 양식을 사용한다.

![image](https://user-images.githubusercontent.com/64796257/148313972-7529db37-b615-4859-a5c8-2349fa15dbae.png)

DESC 명령에 따라 표시되는 결과를 그대로 옮겨적은 것이라 봐도 무방하다. 이외에 어느 열이 기본키 인지를 지정하는 경우도 있다.

테이블을 설계할 때 `테이블 이름`이나 `열 이름`을 지정하는데 하나의 테이블에 대해 `2개의 이름`을 지정할 수 있다.

- 물리명(Name) : DB에 사용될 이름  
⇒ DB 시스템 규칙에 따라 길이에 제한이 있거나 공백문자를 사용할 수 없는 등의 제약이 있다.  
⇒ 그래서 일상적인 단어로 이름을 짓는데 한계가 있다. 그리고 영어를 이용해서 이름을 지정한다.

- 논리명(Logical Name) : 테이블의 설계상 이름  
⇒ 물리명은 여러 제약이 있다보니 제대로 의미가 전달되지 않을 수 있다.
⇒ 이러한 부분을 보완하기 위해서 설계상의 이름으로 사용하는 것이 `논리명`이다. 

때문에 `물리명`과 `논리명`이 함께 기재된 설계도와 정의서가 있다.

![image](https://user-images.githubusercontent.com/64796257/148314538-c0801d76-8409-4ee4-8c42-a4edffb1ac2c.png)

### ER다이어그램 

테이블을 설계할 때 테이블 간의 관계를 명확히 하기 위해서 설계도를 작성하는 경우가 있다. ER다이어그램이 대표적이다.

ER의 E는 Entity / R은 Relationship을 뜻한다. ER 다이어그램은 개체(Entity)간의 관계(Relationship)를 표현한 것이다.  
이와 같은 ER다이어그램은 관계형 데이터베이스 외의 대상에 대해서도 사용된다.

엔티티(Entity)는 테이블 또는 뷰를 의미한다. ER다이어그램에서 개채는 사각형으로 표시한다. 사각형의 상단에는 이름을 적고 하단에는 객체의 속성을 표기한다.  
여기서 속성은 테이블의 열을 의미한다. 

![image](https://user-images.githubusercontent.com/64796257/148315995-ddcd0a90-f194-4242-8bdb-be2b4cd2c5ce.png)

개체와 개체가 서로 연결되는 경우에는 선으로 이어서 표현한다. 

![image](https://user-images.githubusercontent.com/64796257/148316069-4bb6db0d-7e46-47ad-8511-b575eb0c8914.png)

관계(Relationship)를 표시할 때 서로 몇 개의 데이터 행과 연관되는지, 즉 몇 대 몇의 관계를 가지는지를 숫자나 기호로 나타낸다.  
가장 기본적으로 `일대일(1:1)`, `일대다(1:多)`, `다대다(多:多)`가 있다.

ER다이어그램의 연계는 DB에서는 외부키 제약으로 지정되는 경우가 있다.

'설계상 이렇게 되어 있다'를 나타내는 것이 ER다이어그램의 역할이다.

## 35강 정규화 

정규화 : 테이블을 올바른 형태로 변경하고 분할하는 것 

![image](https://user-images.githubusercontent.com/64796257/148316498-34b72481-ba6d-476b-9a8b-ebe64c7e1439.png)

정규화란 DB의 테이블을 규정된 올바른 형태로 개선해나가는 것을 의미한다. 정규화는 DB의 설계단계에서 이뤄진다. 
경우에 따라서 기존 시스템을 재검토할 때 정규화하는 경우도 있다.

### 정규화 

예제를 통해서 정규화에 대해서 알아보자. 

쇼핑 사이트 주문처리 시스템을 구축했다. 이에 대한 주문 데이터를 작성하면 아래와 같다.

![image](https://user-images.githubusercontent.com/64796257/148316919-2d8acb4b-a029-466b-ac3f-d5af84ec9c41.png)

위 데이터를 정규화해서 다듬으려한다. 상품은 상품코드를 이용해서 다루기로 하자.

`0001 ○○ 1개`의 의미는 상품코드가 0001인 상품 ○○를 1개 주문했다는 뜻이다.

이렇게 대충 만들어진 데이터를 정규화해서 DB의 테이블로 만들어보자.

### 제1 정규형

#### 제1 정규화 - 1단계
관계형 데이터베이스의 테이블은 하나의 셀에 하나의 값만 저장할 수 있다는 제약이 있다.  

그래서 기존테이블의 주문상품에 있는 정보를 `상품코드`, `상품명`, `개수`를 담는 3개의 열로 나눠야 한다.

![image](https://user-images.githubusercontent.com/64796257/148317332-c94c4096-87c9-44b3-8c02-8d5117b290b2.png)

위와 같이 구분하면 하나의 셀에 하나의 값만 저장되면서 테이블화 될 수 있다. 테이블의 이름은 주문이라 하겠다.

주문상품 데이터를 상품코드와 개수로 분할함에 따라 열이 2개 추가되었고 행도 늘어났다. 

이와 같이 하나의 셀에 하나의 값만 저장할 수 있도록 하고  
반복되는 부분을 세로 방향(행 방향)으로 늘려나간것이 제1 정규화의 제1 단계이다.

#### 제1 정규화 - 2단계

제1 정규화에서는 `중복을 제거하는 테이블의 분할`도 이뤄진다.  
예를 들면 한 번의 주문으로 여러개의 상품을 주문할 때 주문번호, 날짜, 성명, 연락처가 동일한 값을 가지는 행이 여러 개 존재할 수 있다.

이때 동일한 값을 가지는 행이 여러 개 존재하지 않도록 하나로 정리하자.

![image](https://user-images.githubusercontent.com/64796257/148317786-876474a8-5ed1-4221-8ca4-68b8e7660e3d.png)

먼저 주문 테이블을 `주문 상품 테이블`과 `주문 테이블`로 나눈다. 

`주문 테이블`은 주문번호, 날짜, 성명, 연락처로 구성되어 있다.  
`주문상품 테이블`은 상품코드, 상품명, 개수로 구성되어 있다. 여기에 `주문 테이블`과 결합할 수 있도록 주문 번호 열을 추가했다.

이렇게 정리하면 반복되는 부분이 하나로 깔끔하게 정리되었다. 만약에 주문 데이터가 변경된다면 한 군데만 수정하면 된다.

이렇게 분할을 하고 나면 

`주문 테이블`에서는 주문번호가 중복되지 않기 때문에 `기본키`로 지정할 수 있다.  
`주문상품 테이블`에서는 주문번호와 상품코드를 한데 묶어 `기본키`로 지정할 수 있다.

이처럼 제1 정규화는 반복되는 부분을 찾아서 테이블을 분할하고 기본키가 될 열을 작성하는 과정이다.

### 제2 정규형

제2 정규화는 제1 정규화처럼 데이터가 중복되는 부분을 찾아서 테이블을 분할해 나간다.

이때 기본키에 의해 특정되는 열과 그렇지 않은 열로 나누는 것으로 정규화가 진행된다. 주문 상품 테이블을 다시 살펴보자.





















